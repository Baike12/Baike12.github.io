+++
date = '2025-09-03T11:19:06+08:00'
draft = false
title = 'Rag'
+++

包含两部分：
- 建立索引
- 检索生成
# 1	建立索引
## 1.1	加载文档
## 1.2	拆分文档
将分档拆分成小块有利于：
- 建立索引
- 传递给模型
## 1.3	存储文档
# 2	一个简单例子
## 2.1	文档处理
- 定义加载器
- 分割文档
- 将文档存入向量数据库
## 2.2	状态定义
使用一个类定义状态，包含：
- 问题
- 上下文
- 回答
这个状态也是在图中流转的单位
## 2.3	函数定义
封装检索和模型调用
## 2.4	查询分析
可以对检索到的文档进行分析，之后在传入模型上下文，比如：
- 限制检索到的内容年份
- 对查询进行重写
### 2.4.1	流程
- 定义个查询分析类
- 定义状态类，其中包含查询分析类
- 定义查询分析函数：其中调用一次模型，让模型输出符合查询分析类的格式化查询，相当于重写一次查询，然后将
# 3	处理历史消息
langgraph内置有多种消息：
- 用户输入作为人类消息
- 工具调用作为ai消息
- 检索文档作为工具消息
- 最后的响应也作为ai消息
## 3.1	checkpoint
langchain使用checkpoint来持久化状态state
# 4	agent
langgraph内置了react agent框架，可以将tool调用的结果作为agent的输入，驱动下一个tool调用或者结束